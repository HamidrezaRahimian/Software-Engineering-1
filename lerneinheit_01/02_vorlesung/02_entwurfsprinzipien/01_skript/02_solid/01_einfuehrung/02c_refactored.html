<br>
<p><span style="font-family: Arial, Helvetica, sans-serif; color: rgb(166, 10, 8); font-size: 22px;">Software Architecture | Refactored</span></p>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.baggage;

<span style="font-weight: bold">public</span> <span style="font-weight: bold">enum</span> TicketClass {
    ECONOMY, BUSINESS, PREMIUM
}
</pre></td></tr></table></div>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.fee;

<span style="font-weight: bold">public</span> <span style="font-weight: bold">enum</span> FeeType {
    EXTRA_BAG, OVERWEIGHT, FRAGILE_ITEM
}
</pre></td></tr></table></div>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.payment;

<span style="font-weight: bold">public</span> <span style="font-weight: bold">enum</span> PaymentMethod {
    CARD, CASH
}
</pre></td></tr></table></div>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.baggage;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">lombok.NoArgsConstructor</span>;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.HashMap</span>;
<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.List</span>;
<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.Map</span>;
<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.UUID</span>;

@NoArgsConstructor
<span style="font-weight: bold">public</span> <span style="font-weight: bold">class</span> <span style="font-weight: bold">BaggageTracking</span> {
    <span style="font-weight: bold">public</span> Map&lt;String, String&gt; generateTrackingInfo(List&lt;String&gt; items) {
        Map&lt;String, String&gt; trackingInfo = <span style="font-weight: bold">new</span> HashMap&lt;&gt;();
        <span style="font-weight: bold">for</span> (String item : items) {
            trackingInfo.put(item, <span style="font-style: italic">&quot;TRACK-&quot;</span> + UUID.randomUUID());
        }
        <span style="font-weight: bold">return</span> trackingInfo;
    }
}
</pre></td></tr></table></div>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.baggage;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">lombok.NoArgsConstructor</span>;

@NoArgsConstructor
<span style="font-weight: bold">public</span> <span style="font-weight: bold">class</span> <span style="font-weight: bold">BaggageCounter</span> {
    <span style="font-weight: bold">private</span> <span style="font-weight: bold">int</span> counter = 0;

    <span style="font-weight: bold">public</span> <span style="font-weight: bold">void</span> update(<span style="font-weight: bold">int</span> count) {
        counter += count;
        System.out.println(<span style="font-style: italic">&quot;total baggage items processed: &quot;</span> + counter);
    }
}
</pre></td></tr></table></div>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.baggage;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">lombok.NoArgsConstructor</span>;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.Arrays</span>;
<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.List</span>;

@NoArgsConstructor
<span style="font-weight: bold">public</span> <span style="font-weight: bold">class</span> <span style="font-weight: bold">BaggageValidator</span> {
    <span style="font-weight: bold">private</span> <span style="font-weight: bold">static</span> <span style="font-weight: bold">final</span> List&lt;String&gt; PROHIBITED_ITEMS = Arrays.asList(<span style="font-style: italic">&quot;Explosives&quot;</span>, <span style="font-style: italic">&quot;Flammable Liquids&quot;</span>);

    <span style="font-weight: bold">public</span> <span style="font-weight: bold">void</span> validate(List&lt;String&gt; items) {
        <span style="font-weight: bold">for</span> (String item : items) {
            <span style="font-weight: bold">if</span> (PROHIBITED_ITEMS.contains(item)) {
                System.out.println(<span style="font-style: italic">&quot;error: prohibited item detected.&quot;</span>);
                <span style="font-weight: bold">return</span>;
            }
            <span style="font-weight: bold">if</span> (item.length() &gt; 20) {
                System.out.println(<span style="font-style: italic">&quot;error: item name too long.&quot;</span>);
                <span style="font-weight: bold">return</span>;
            }
        }
    }
}
</pre></td></tr></table></div>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.currency;

<span style="font-weight: bold">public</span> <span style="font-weight: bold">interface</span> <span style="font-weight: bold">ICurrencyConverter</span> {
    <span style="font-weight: bold">double</span> convert(<span style="font-weight: bold">double</span> amount, String currency);
}
</pre></td></tr></table></div>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.currency;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">lombok.AllArgsConstructor</span>;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.Map</span>;

@AllArgsConstructor
<span style="font-weight: bold">public</span> <span style="font-weight: bold">class</span> <span style="font-weight: bold">StandardCurrencyConverter</span> <span style="font-weight: bold">implements</span> ICurrencyConverter {
    <span style="font-weight: bold">private</span> <span style="font-weight: bold">static</span> <span style="font-weight: bold">final</span> Map&lt;String, Double&gt; EXCHANGE_RATES = Map.of(
            <span style="font-style: italic">&quot;USD&quot;</span>, 1.0,
            <span style="font-style: italic">&quot;EUR&quot;</span>, 0.85,
            <span style="font-style: italic">&quot;JPY&quot;</span>, 110.0
    );

    @Override
    <span style="font-weight: bold">public</span> <span style="font-weight: bold">double</span> convert(<span style="font-weight: bold">double</span> amount, String currency) {
        Double rate = EXCHANGE_RATES.get(currency);
        <span style="font-weight: bold">if</span> (rate == <span style="font-weight: bold">null</span>) {
            <span style="font-weight: bold">throw</span> <span style="font-weight: bold">new</span> IllegalArgumentException(<span style="font-style: italic">&quot;unsupported currency: &quot;</span> + currency);
        }
        <span style="font-weight: bold">return</span> amount * rate;
    }
}
</pre></td></tr></table></div>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.fee;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.List</span>;

<span style="font-weight: bold">public</span> <span style="font-weight: bold">interface</span> <span style="font-weight: bold">IFeeCalculator</span> {
    <span style="font-weight: bold">double</span> calculate(List&lt;FeeType&gt; feeTypes);
}
</pre></td></tr></table></div>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.fee;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">lombok.AllArgsConstructor</span>;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.List</span>;
<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.Map</span>;

@AllArgsConstructor
<span style="font-weight: bold">public</span> <span style="font-weight: bold">class</span> <span style="font-weight: bold">StandardFeeCalculator</span> <span style="font-weight: bold">implements</span> IFeeCalculator {
    <span style="font-weight: bold">private</span> <span style="font-weight: bold">static</span> <span style="font-weight: bold">final</span> Map&lt;FeeType, Double&gt; FEE_RATES = Map.of(
            FeeType.EXTRA_BAG, 100.0,
            FeeType.OVERWEIGHT, 200.0,
            FeeType.FRAGILE_ITEM, 50.0
    );

    <span style="font-weight: bold">public</span> <span style="font-weight: bold">double</span> calculate(List&lt;FeeType&gt; feeTypes) {
        <span style="font-weight: bold">return</span> feeTypes.stream()
                .mapToDouble(FEE_RATES::get)
                .sum();
    }
}
</pre></td></tr></table></div>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.payment;

<span style="font-weight: bold">public</span> <span style="font-weight: bold">interface</span> <span style="font-weight: bold">IPaymentProcessor</span> {
    <span style="font-weight: bold">boolean</span> process(PaymentMethod method, <span style="font-weight: bold">double</span> amount);
}
</pre></td></tr></table></div>
<br>
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.payment;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">lombok.AllArgsConstructor</span>;

@AllArgsConstructor
<span style="font-weight: bold">public</span> <span style="font-weight: bold">class</span> <span style="font-weight: bold">StandardPaymentProcessor</span> <span style="font-weight: bold">implements</span> IPaymentProcessor {
    @Override
    <span style="font-weight: bold">public</span> <span style="font-weight: bold">boolean</span> process(PaymentMethod method, <span style="font-weight: bold">double</span> amount) {
        <span style="font-weight: bold">return</span> switch (method) {
            <span style="font-weight: bold">case</span> CARD -&gt; processCardPayment(amount);
            <span style="font-weight: bold">case</span> CASH -&gt; {
                System.out.println(<span style="font-style: italic">&quot;cash payment not supported.&quot;</span>);
                yield <span style="font-weight: bold">false</span>;
            }
        };
    }

    <span style="font-weight: bold">private</span> <span style="font-weight: bold">boolean</span> processCardPayment(<span style="font-weight: bold">double</span> amount) {
        <span style="font-weight: bold">return</span> amount &gt; 0;
    }
}
</pre></td></tr></table></div>
<br>
<br><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="font-weight: bold">package</span> refactored.baggage;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">lombok.AllArgsConstructor</span>;
<span style="font-weight: bold">import</span> <span style="font-weight: bold">refactored.currency.ICurrencyConverter</span>;
<span style="font-weight: bold">import</span> <span style="font-weight: bold">refactored.fee.FeeType</span>;
<span style="font-weight: bold">import</span> <span style="font-weight: bold">refactored.fee.IFeeCalculator</span>;
<span style="font-weight: bold">import</span> <span style="font-weight: bold">refactored.payment.IPaymentProcessor</span>;
<span style="font-weight: bold">import</span> <span style="font-weight: bold">refactored.payment.PaymentMethod</span>;

<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.List</span>;
<span style="font-weight: bold">import</span> <span style="font-weight: bold">java.util.Map</span>;

@AllArgsConstructor
<span style="font-weight: bold">public</span> <span style="font-weight: bold">class</span> <span style="font-weight: bold">SelfBaggageDrop</span> {
    <span style="font-weight: bold">private</span> <span style="font-weight: bold">final</span> IPaymentProcessor paymentProcessor;
    <span style="font-weight: bold">private</span> <span style="font-weight: bold">final</span> BaggageValidator baggageValidator;
    <span style="font-weight: bold">private</span> <span style="font-weight: bold">final</span> BaggageTracking baggageTracking;
    <span style="font-weight: bold">private</span> <span style="font-weight: bold">final</span> ICurrencyConverter currencyConverter;
    <span style="font-weight: bold">private</span> <span style="font-weight: bold">final</span> IFeeCalculator feeCalculator;
    <span style="font-weight: bold">private</span> <span style="font-weight: bold">final</span> BaggageCounter baggageCounter;

    <span style="font-weight: bold">public</span> <span style="font-weight: bold">void</span> initiateBaggageDrop(<span style="font-weight: bold">int</span> passengerId, String passengerName, String destination, String flightNumber, TicketClass ticketClass,
                                    List&lt;String&gt; baggageItems, PaymentMethod paymentMethod) {
        <span style="font-weight: bold">if</span> (!validatePassengerTicket(ticketClass, baggageItems.size())) <span style="font-weight: bold">return</span>;

        <span style="font-weight: bold">double</span> totalFee = feeCalculator.calculate(getFeeTypes(baggageItems));
        <span style="font-weight: bold">double</span> paymentAmount = currencyConverter.convert(totalFee, <span style="font-style: italic">&quot;USD&quot;</span>);

        <span style="font-weight: bold">if</span> (!paymentProcessor.process(paymentMethod, paymentAmount)) {
            System.out.println(<span style="font-style: italic">&quot;payment failed.&quot;</span>);
            <span style="font-weight: bold">return</span>;
        }

        baggageValidator.validate(baggageItems);

        <span style="font-weight: bold">if</span> (calculateTotalWeight(baggageItems) &gt; 200) {
            System.out.println(<span style="font-style: italic">&quot;error: excessive weight.&quot;</span>);
            <span style="font-weight: bold">return</span>;
        }

        Map&lt;String, String&gt; trackingInfo = baggageTracking.generateTrackingInfo(baggageItems);
        printReceipt(passengerName, destination, flightNumber, ticketClass, baggageItems, paymentAmount, trackingInfo);
        baggageCounter.update(baggageItems.size());
    }

    <span style="font-weight: bold">private</span> <span style="font-weight: bold">boolean</span> validatePassengerTicket(TicketClass ticketClass, <span style="font-weight: bold">int</span> itemCount) {
        <span style="font-weight: bold">if</span> (itemCount &gt; 3 &amp;&amp; !ticketClass.equals(TicketClass.PREMIUM)) {
            System.out.println(<span style="font-style: italic">&quot;error: non-premium passengers can only drop 3 bags.&quot;</span>);
            <span style="font-weight: bold">return</span> <span style="font-weight: bold">false</span>;
        }
        <span style="font-weight: bold">return</span> <span style="font-weight: bold">true</span>;
    }

    <span style="font-weight: bold">private</span> List&lt;FeeType&gt; getFeeTypes(List&lt;String&gt; items) {
        <span style="font-weight: bold">return</span> List.of(FeeType.EXTRA_BAG, FeeType.OVERWEIGHT);
    }

    <span style="font-weight: bold">private</span> <span style="font-weight: bold">double</span> calculateTotalWeight(List&lt;String&gt; items) {
        <span style="font-weight: bold">return</span> items.size() * 10;
    }

    <span style="font-weight: bold">private</span> <span style="font-weight: bold">void</span> printReceipt(String name, String destination, String flightNumber, TicketClass ticketClass, List&lt;String&gt; items,
                              <span style="font-weight: bold">double</span> amount, Map&lt;String, String&gt; trackingInfo) {
        System.out.println(<span style="font-style: italic">&quot;--- printing receipt ---&quot;</span>);
        System.out.println(<span style="font-style: italic">&quot;passenger            : &quot;</span> + name);
        System.out.println(<span style="font-style: italic">&quot;destination          : &quot;</span> + destination);
        System.out.println(<span style="font-style: italic">&quot;flight number        : &quot;</span> + flightNumber);
        System.out.println(<span style="font-style: italic">&quot;ticket class         : &quot;</span> + ticketClass);
        System.out.println(<span style="font-style: italic">&quot;baggage items        : &quot;</span> + items);
        System.out.println(<span style="font-style: italic">&quot;total fee            : &quot;</span> + amount);
        System.out.println(<span style="font-style: italic">&quot;tracking information : &quot;</span> + trackingInfo);
        System.out.println(<span style="font-style: italic">&quot;receipt printed successfully.&quot;</span>);
    }
}
</pre></td></tr></table></div>
<br>
<p><span style="font-family: Arial, Helvetica, sans-serif; font-size: 11px;">Prof. Dr. Carsten M&uuml;ller <span style="color: rgb(166, 10, 8);">|</span> Software Engineering</span></p>